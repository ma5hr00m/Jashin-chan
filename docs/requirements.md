<div align="center">

<h1>说明文档</h1>

</div>

> ## 需求说明
> 1. 后端语言 PHP，不使用框架
> 2. 前端技术无限制
> 3. 数据库使用MariaDB
> 4. 账号注册登陆功能
> 5. 支持多用户使用
> 6. 支持发送文本信息、图片、文件
> 7. 防范常见的web漏洞

## 介绍

基于php实现的线上聊天室。

## 功能

- 注册登陆删除账号
- 账号信息设置
- 创建加入删除聊天室
- 发送接收文本消息
- 发送接收预设表情
- 发送接收图片
- 发送接收文件
- 显示在线用户

## 页面

- Login: 登陆
  - 注册
  - 登陆
- Home: 主页
  - 聊天室介绍
  - 查询在线用户
  - 聊天室列表
- User: 账号信息
  - 获取用户信息
  - 更新用户信息
  - 删除用户
- Room: 聊天室
  - 获取聊天记录
  - 发送文本信息
  - 发送文件
  - 发送图片


## 数据表结构

### 用户表

| 字段       | 类型       | 描述    |
|----------|----------|-------|
| id       | int      | 用户ID  |
| username | varchar  | 用户名   |
| password | varchar  | 用户密码  |
| email    | varchar  | 用户邮箱  |
 | state    | int      | 用户状态  |

### 聊天室表

| 字段       | 类型      | 描述    |
|----------|---------|-------|
| id       | int     | 聊天室ID |
| name     | varchar | 聊天室名称 |
| owner_id | int     | 房主ID  |

### 聊天记录表

| 字段        | 类型       | 描述     |
|-----------|----------|--------|
| id        | int      | 聊天记录ID |
| sender_id | int      | 发送人ID  |
| room_id   | int      | 聊天室ID  |
| message   | varchar  | 信息内容   |
| timestamp | datetime | 信息时间戳  |

## API接口

### 用户操作

#### 注册账号

请求方式 POST

请求URL /register.php

请求参数

| 参数名      | 类型     | 是否必要 | 描述   |
|----------|--------|------|------|
| username | string | true | 用户名  |
| password | string | true | 用户密码 |
| email    | string | true | 用户邮箱 |

响应参数

| 参数名  | 类型   | 描述               |
|------|------|------------------|
| code | int  | 结果码，0失败，1成功      |
| data | int  | 用户ID，成功时返回，失败时为空 |


#### 登录账号

请求方式 POST

请求URL /login.php

请求参数

| 参数名      | 类型     | 是否必要 | 描述  |
|----------|--------|------|-----|
| username | string | true | 用户名 |
| password | string | true | 密码  |

响应参数

| 参数名  | 类型  | 描述                 |
|------|-----|--------------------|
| code | int | 结果码，0失败，1成功        |
| data | 对象  | 用户信息，登陆成功时返回，失败时为空 |

#### 删除账号

请求方式 DELETE

请求URL /delete.php

请求参数

| 参数名     | 类型   | 是否必须 | 描述   |
|---------|------|------|------|
| user_id | int  | true | 用户ID |

响应参数

| 参数名  | 类型  | 描述                 |
|------|-----|--------------------|
| code | int | 结果码，0失败，1成功        |

#### 查询账号信息

请求方式 GET

请求URL /user.php

请求参数

| 参数名     | 类型   | 是否必须 | 描述   |
|---------|------|------|------|
| user_id | int  | true | 用户ID |

响应参数

| 参数名  | 类型  | 描述                 |
|------|-----|--------------------|
| code | int | 结果码，0失败，1成功        |
| data | 对象  | 用户信息，登陆成功时返回，失败时为空 |

#### 更新账号信息

请求方式 UPDATE

请求URL /updateUser.php

请求参数

| 参数名      | 类型      | 是否必要   | 描述     |
|----------|---------|--------|--------|
| id       | int     | true   | 用户ID   |
| username | string  | true   | 用户名    |
| password | string  | true   | 用户密码   |
| email    | string  | true   | 用户邮箱   |

响应参数

| 参数名  | 类型  | 描述                 |
|------|-----|--------------------|
| code | int | 结果码，0失败，1成功        |

### 聊天室操作

#### 创建聊天室

请求方式 POST

请求URL /createRoom.php

请求参数

| 参数名      | 类型     | 是否必要 | 描述   |
|----------|--------|------|------|
| name     | string | true | 房间名称 |
| owner_id | int    | true | 房主ID |

响应参数

| 参数名  | 类型   | 描述                |
|------|------|-------------------|
| code | int  | 结果码，0失败，1成功       |
| data | 对象   | 聊天室ID，成功时返回，失败时为空 |

#### 加入聊天室

请求参数 POST

请求URL /joinRoom.php

请求参数

| 参数名     | 类型  | 是否必要 | 描述   |
|---------|-----|------|------|
| user_id | int | true | 用户ID |
| root_id | int | true | 房间ID |

响应参数

| 参数名  | 类型   | 描述          |
|------|------|-------------|
| code | int  | 结果码，0失败，1成功 |


#### 删除聊天室

请求方式 DELETE

请求URL /deleteRoom.php

请求参数

| 参数名     | 类型   | 是否必须 | 描述   |
|---------|------|------|------|
| room_id | int  | true | 房间ID |

响应参数

| 参数名  | 类型  | 描述                 |
|------|-----|--------------------|
| code | int | 结果码，0失败，1成功        |

#### 获取聊天室列表

请求方式 GET

请求URL /roomList.php

请求参数 无

响应参数

| 参数名  | 类型  | 描述                    |
|------|-----|-----------------------|
| code | int | 结果码，0失败，1成功           |
| data | 数组  | 包含聊天室ID和名称的对象数组，失败时为空 |

### 聊天记录操作

#### 发送文本消息

请求方式 POST

请求URL /sendMessage.php

请求参数

| 参数名       | 类型     | 是否必要 | 描述    |
|-----------|--------|------|-------|
| sender_id | int    | true | 发送人ID |
| room_id   | int    | true | 房间ID  |
| message   | string | true | 信息内容  |

响应参数

| 参数名  | 类型  | 描述                    |
|------|-----|-----------------------|
| code | int | 结果码，0失败，1成功           |

#### 发送文件

请求方式 POST

请求URL /sendFile.php

请求参数

| 参数名       | 类型   | 是否必要 | 描述    |
|-----------|------|------|-------|
| sender_id | int  | true | 发送人ID |
| room_id   | int  | true | 房间ID  |
| file   | file | true | 文件    |

响应参数

| 参数名  | 类型  | 描述                    |
|------|-----|-----------------------|
| code | int | 结果码，0失败，1成功           |

#### 查询聊天记录

请求方式 GET

请求URL /getMessage.php

请求参数 

| 参数名       | 类型  | 是否必要 | 描述    |
|-----------|-----|------|-------|
| room_id   | int | true | 房间ID  |

响应参数

| 参数名  | 类型  | 描述                |
|------|-----|-------------------|
| code | int | 结果码，0失败，1成功       |
| data | 数组  | 包含聊天记录的对象数组，失败时为空 |

### 在线用户操作

#### 获取在线用户列表

请求方式 GET

请求URL /usrList.php

请求参数 无

响应参数

| 参数名  | 类型  | 描述                     |
|------|-----|------------------------|
| code | int | 结果码，0失败，1成功            |
| data | 数组  | 包含在线用户ID和名称的对象数组，失败时为空 |

## 技术栈

- php
- Vue
- MariaDB

## 开发人员

- ma5hr00m